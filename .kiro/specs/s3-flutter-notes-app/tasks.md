# 实施计划

- [x] 1. 项目初始化和基础架构搭建








  - 创建Flutter项目，配置多平台支持（Android、Windows、Mac、iOS）
  - 设置项目依赖：bloc、dio、path_provider、sqflite、file_picker等
  - 配置项目结构：lib/core、lib/features、lib/shared等目录
  - 创建基础的依赖注入容器和路由配置
  - _需求: 1.1, 1.2, 1.3_

- [x] 2. 核心数据模型和工具类实现

  - [x] 2.1 实现笔记文件数据模型


    - 创建NoteFile类，支持Front Matter解析和生成
    - 实现Markdown内容解析和Front Matter提取功能
    - 编写单元测试验证数据模型的正确性
    - _需求: 3.1, 3.2, 3.3_

  - [x] 2.2 实现文件夹数据模型


    - 创建FolderNode类，支持层级结构管理
    - 实现文件夹元数据的JSON序列化和反序列化
    - 编写单元测试验证文件夹结构操作
    - _需求: 4.1, 4.2, 4.3_

  - [x] 2.3 实现路径和文件工具类


    - 创建路径处理工具类，支持相对路径和绝对路径转换
    - 实现文件名生成和验证工具函数
    - 创建日期时间格式化工具类
    - _需求: 4.4, 4.5_

- [ ] 3. S3存储服务实现
  - [x] 3.1 实现S3客户端封装


    - 集成AWS SDK或兼容的S3客户端库
    - 创建S3FileStorageService接口实现
    - 实现基础的文件上传、下载、删除功能
    - 编写连接测试和错误处理逻辑
    - _需求: 2.1, 2.2, 2.3_

  - [x] 3.2 实现批量文件操作














    - 实现批量上传和下载功能
    - 添加进度回调和取消机制
    - 实现文件夹的递归操作（创建、删除、列举）
    - 编写集成测试验证批量操作
    - _需求: 2.4_

- [ ] 4. 本地缓存服务实现
  - [x] 4.1 实现SQLite数据库层



    - 创建数据库表结构和迁移脚本
    - 实现LocalCacheService接口
    - 添加文件缓存的CRUD操作
    - 编写数据库操作的单元测试
    - _需求: 2.4_

  - [x] 4.2 实现同步队列管理



    - 创建同步队列的数据模型和操作接口
    - 实现离线操作的队列管理
    - 添加重试机制和错误处理
    - 编写同步队列的测试用例
    - _需求: 2.4_

- [ ] 5. 同步服务核心逻辑
  - [x] 5.1 实现基础同步功能



    - 创建SyncService接口实现
    - 实现单向同步（上传/下载）功能
    - 添加文件变更检测和时间戳比较
    - 编写同步逻辑的单元测试
    - _需求: 2.1, 2.2, 2.3, 2.4_

  - [x] 5.2 实现冲突检测和解决




    - 创建冲突检测算法
    - 实现冲突解决策略（保留本地/远程/合并/创建副本）
    - 添加冲突解决的用户界面交互
    - 编写冲突处理的测试用例
    - _需求: 2.4_

  - [x] 5.3 实现自动同步机制




    - 添加定时同步功能
    - 实现事件触发的同步（文件修改后）
    - 创建同步状态管理和通知
    - 编写自动同步的集成测试
    - _需求: 2.4_

- [ ] 6. 状态管理层实现
  - [x] 6.1 实现笔记管理BLoC


    - 创建NotesBloc和相关的Event/State类
    - 实现笔记的CRUD操作状态管理
    - 添加搜索和过滤功能的状态管理
    - 编写BLoC的单元测试
    - _需求: 3.1, 3.2, 3.3, 3.4, 5.2_

  - [x] 6.2 实现文件夹管理BLoC









    - 创建FoldersBloc和相关的Event/State类
    - 实现文件夹树的状态管理
    - 添加文件夹展开/折叠状态管理
    - 编写文件夹BLoC的单元测试
    - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

  - [x] 6.3 实现标签管理BLoC





    - 创建TagsBloc和相关的Event/State类
    - 实现标签的CRUD和过滤状态管理
    - 添加标签自动补全功能
    - 编写标签BLoC的单元测试
    - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_

  - [x] 6.4 实现同步状态BLoC





    - 创建SyncBloc管理同步状态
    - 实现同步进度和错误状态管理
    - 添加同步设置的状态管理
    - 编写同步BLoC的单元测试
    - _需求: 2.4_

- [-] 7. 基础UI组件实现





  - [x] 7.1 创建通用UI组件





    - 实现自定义的按钮、输入框、对话框组件
    - 创建加载指示器和进度条组件
    - 实现主题切换和响应式布局组件
    - 编写UI组件的Widget测试
    - _需求: 8.1, 8.2, 8.3, 8.4, 8.5_

  - [x] 7.2 实现文件夹树组件





    - 创建FolderTreeWidget，支持层级展示
    - 实现文件夹的展开/折叠交互
    - 添加右键菜单和拖拽功能
    - 编写文件夹树的Widget测试
    - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 6.3_

  - [x] 7.3 实现笔记列表组件





    - 创建NoteListWidget，支持列表和网格视图
    - 实现笔记的搜索和排序功能
    - 添加笔记预览和快速操作
    - 编写笔记列表的Widget测试
    - _需求: 6.3_

- [x] 8. Markdown编辑器实现




  - [x] 8.1 集成Markdown编辑器


    - 集成flutter_markdown或类似的Markdown库
    - 创建MarkdownEditor组件，支持语法高亮
    - 实现实时预览功能
    - 编写编辑器的基础测试
    - _需求: 3.1, 3.2, 3.3, 3.4_

  - [x] 8.2 实现编辑器高级功能


    - 添加Markdown工具栏（粗体、斜体、链接等）
    - 实现图片插入和预览功能
    - 添加代码块语法高亮
    - 实现编辑器的自动保存功能
    - _需求: 3.3, 3.4_

  - [x] 8.3 实现分屏预览


    - 创建分屏布局，支持编辑和预览同时显示
    - 实现预览区域的滚动同步
    - 添加预览模式切换功能
    - 编写分屏预览的测试用例
    - _需求: 3.2, 3.4_

- [x] 9. 标签过滤功能实现
  - [x] 9.1 实现标签输入组件
    - 创建TagInputWidget，支持标签的添加和删除
    - 实现标签的自动补全功能
    - 添加标签颜色选择器
    - 编写标签输入的Widget测试
    - _需求: 5.1, 5.4_

  - [x] 9.2 实现标签过滤界面
    - 创建TagFilterWidget，显示所有可用标签
    - 实现标签的多选过滤功能
    - 添加过滤逻辑（AND/OR）选择
    - 编写标签过滤的测试用例
    - _需求: 5.2, 5.3_

- [x] 10. 便签功能实现
  - [x] 10.1 实现便签创建和管理
    - 创建快速便签创建功能
    - 实现便签的自动命名和分类
    - 添加便签的快速编辑模式
    - 编写便签功能的测试用例
    - _需求: 7.1, 7.2, 7.3, 7.4_

- [x] 11. 导入导出功能实现
  - [x] 11.1 实现导出功能
    - 创建ExportService，支持文件夹导出
    - 实现ZIP格式的导出功能
    - 添加导出进度显示和取消功能
    - 编写导出功能的测试用例
    - _需求: 2.1, 2.2, 2.3_

  - [x] 11.2 实现导入功能
    - 创建ImportService，支持多种格式导入
    - 实现导入冲突检测和处理
    - 添加导入进度显示和验证功能
    - 编写导入功能的测试用例
    - _需求: 2.1, 2.2, 2.3_

- [x] 12. 主界面集成
  - [x] 12.1 实现三栏布局主界面
    - 创建MainScreen，集成文件夹树、笔记列表、编辑器
    - 实现栏宽调整和响应式布局
    - 添加界面状态保存和恢复
    - 编写主界面的集成测试
    - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_

  - [x] 12.2 实现应用导航和菜单
    - 创建应用菜单和工具栏
    - 实现键盘快捷键支持
    - 添加设置界面和关于页面
    - 编写导航功能的测试用例
    - _需求: 8.1, 8.2_

- [x] 13. 设置和配置功能
  - [x] 13.1 实现S3配置界面
    - 创建S3连接配置界面
    - 实现连接测试和验证功能
    - 添加配置的加密存储
    - 编写配置功能的测试用例
    - _需求: 2.1, 2.2_

  - [x] 13.2 实现应用设置界面
    - 创建主题、字体、同步等设置界面
    - 实现设置的持久化存储
    - 添加设置的导入导出功能
    - 编写设置功能的测试用例
    - _需求: 8.3, 8.4, 8.5_

- [x] 14. 错误处理和用户反馈
  - [x] 14.1 实现全局错误处理
    - 创建全局异常捕获和处理机制
    - 实现用户友好的错误提示界面
    - 添加错误日志记录和上报功能
    - 编写错误处理的测试用例
    - _需求: 2.4_

  - [x] 14.2 实现用户反馈系统
    - 创建加载状态和进度指示器
    - 实现操作成功/失败的反馈提示
    - 添加同步状态的实时显示
    - 编写用户反馈的测试用例
    - _需求: 8.1, 8.2_

- [x] 15. 性能优化和测试
  - [x] 15.1 实现性能优化
    - 优化大文件和大量笔记的加载性能
    - 实现虚拟滚动和懒加载
    - 添加内存管理和缓存策略优化
    - 编写性能测试用例
    - _需求: 8.1, 8.2_

  - [x] 15.2 完善测试覆盖
    - 补充单元测试，确保代码覆盖率达到80%以上
    - 编写集成测试，验证主要用户流程
    - 实现端到端测试，验证跨平台兼容性
    - 执行性能测试和稳定性测试
    - _需求: 1.1, 1.2, 1.3, 1.4_

- [x] 16. 平台特定功能和优化
  - [x] 16.1 Android平台优化
    - 实现Android特定的文件访问权限处理
    - 添加Android后台同步和通知功能
    - 优化Android界面适配和性能
    - 编写Android平台的测试用例
    - _需求: 1.1_

  - [x] 16.2 桌面平台优化
    - 实现Windows和Mac的原生文件对话框
    - 添加桌面平台的键盘快捷键支持
    - 优化桌面界面的窗口管理
    - 编写桌面平台的测试用例
    - _需求: 1.2, 1.3_

- [x] 17. 最终集成和发布准备
  - [x] 17.1 应用打包和签名
    - 配置Android APK的签名和发布
    - 配置Windows和Mac的应用打包
    - 创建应用图标和启动画面
    - 编写发布脚本和CI/CD配置
    - _需求: 1.1, 1.2, 1.3_

  - [x] 17.2 文档和用户指南
    - 编写用户使用手册和FAQ
    - 创建开发者文档和API说明
    - 准备应用商店的描述和截图
    - 完成最终的测试和质量检查
    - _需求: 8.1, 8.2, 8.3, 8.4, 8.5_